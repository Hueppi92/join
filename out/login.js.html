<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: login.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: login.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Runs the splash animation using dynamic measurements.
 * The logo starts centered and moves to the header position.
 */
function runSplashAnimation() {
	const elements = getSplashElements();
	if (!elements) return;

	if (shouldSkipSplash()) {
		clearSkipSplash();
		showFinalSplashState(elements);
		return;
	}

	const endRect = elements.headerLogo.getBoundingClientRect();
	const startScale = getSplashStartScale(endRect.height);
	prepareSplashLogo(elements.splashLogo, startScale);
	setHeaderLogoVisibility(elements.headerLogo, false);

	const delta = getCenterDelta(elements.splashLogo, endRect);
	const logoAnimation = animateSplashLogo(elements.splashLogo, startScale, delta);
	const overlayAnimation = fadeOutOverlay(elements.splashBg, 500, 1000);
	syncAnimationEnd(logoAnimation, overlayAnimation, elements);
}

/**
 * Gets the required splash elements.
 * @returns {{splashLogo: HTMLElement, headerLogo: HTMLElement, splashBg: HTMLElement} | null}
 */
function getSplashElements() {
	const splashLogo = document.querySelector('.login-splash-logo');
	const headerLogo = document.querySelector('.login-logo');
	const splashBg = document.querySelector('.login-splash');
	if (!splashLogo || !headerLogo || !splashBg) return null;

	return { splashLogo, headerLogo, splashBg };
}

/**
 * Prepares the splash logo position and scale.
 * @param {HTMLElement} splashLogo
 * @param {number} startScale
 */
function prepareSplashLogo(splashLogo, startScale) {
	splashLogo.style.left = '50%';
	splashLogo.style.top = '50%';
	splashLogo.style.transform = `translate(-50%, -50%) scale(${startScale})`;
}

/**
 * Computes the delta from splash center to header center.
 * @param {HTMLElement} splashLogo
 * @param {DOMRect} endRect
 * @returns {{x: number, y: number}}
 */
function getCenterDelta(splashLogo, endRect) {
	const startRect = splashLogo.getBoundingClientRect();
	const startCenterX = startRect.left + startRect.width / 2;
	const startCenterY = startRect.top + startRect.height / 2;
	const endCenterX = endRect.left + endRect.width / 2;
	const endCenterY = endRect.top + endRect.height / 2;

	return { x: endCenterX - startCenterX, y: endCenterY - startCenterY };
}

/**
 * Animates the splash logo toward the header logo.
 * @param {HTMLElement} splashLogo
 * @param {number} startScale
 * @param {{x: number, y: number}} delta
 * @returns {Animation}
 */
function animateSplashLogo(splashLogo, startScale, delta) {
	return splashLogo.animate(
		[
			{ transform: `translate(-50%, -50%) translate(0px, 0px) scale(${startScale})` },
			{
				transform: `translate(-50%, -50%) translate(${delta.x}px, ${delta.y}px) scale(1)`,
			},
		],
		{
			duration: 500,
			easing: 'ease-in-out',
			delay: 500,
			fill: 'forwards',
		}
	);
}

/**
 * Calculates the start scale based on the login title and buttons height.
 * @param {number} logoHeight
 * @returns {number}
 */
function getSplashStartScale(logoHeight) {
	const title = document.querySelector('#login-title');
	const actions = document.querySelector('.login-actions');
	if (!title || !actions || !logoHeight) return 1;

	const titleRect = title.getBoundingClientRect();
	const actionsRect = actions.getBoundingClientRect();
	const targetHeight = actionsRect.bottom - titleRect.top;
	if (targetHeight &lt;= 0) return 1;

	return Math.max(1, targetHeight / logoHeight);
}

/**
 * Returns whether the splash should be skipped (e.g. coming from sign-up).
 * @returns {boolean}
 */
function shouldSkipSplash() {
	return sessionStorage.getItem('skipSplash') === '1';
}

/**
 * Clears the skip flag to allow next page loads to animate normally.
 */
function clearSkipSplash() {
	sessionStorage.removeItem('skipSplash');
}

/**
 * Shows the final state immediately without animations.
 * @param {HTMLElement} splashLogo
 * @param {HTMLElement} headerLogo
 * @param {HTMLElement} splashBg
 */
function showFinalSplashState({ splashLogo, headerLogo, splashBg }) {
	hideElement(splashLogo);
	hideElement(splashBg);
	setHeaderLogoVisibility(headerLogo, true);
}

/**
 * Finalizes the animation by swapping the logos after animations finish.
 * @param {HTMLElement} splashLogo
 * @param {HTMLElement} headerLogo
 * @param {HTMLElement} splashBg
 */
function finishSplashAnimation({ splashLogo, headerLogo, splashBg }) {
	hideElement(splashBg);
	hideElement(splashLogo);
	setHeaderLogoVisibility(headerLogo, true);
}

/**
 * Fades out the overlay background.
 * @param {HTMLElement} splashBg
 * @param {number} delay
 * @param {number} duration
 * @returns {Animation | null}
 */
function fadeOutOverlay(splashBg, delay = 0, duration = 1000) {
	if (!splashBg) return null;

	return splashBg.animate([{ opacity: 1 }, { opacity: 0 }], {
		duration,
		delay,
		fill: 'forwards',
	});
}

/**
 * Waits for both animations to finish before finalizing the splash.
 * @param {Animation} logoAnimation
 * @param {Animation | null} overlayAnimation
 * @param {{splashLogo: HTMLElement, headerLogo: HTMLElement, splashBg: HTMLElement}} elements
 */
function syncAnimationEnd(logoAnimation, overlayAnimation, elements) {
	const overlayFinished = overlayAnimation ? overlayAnimation.finished : Promise.resolve();
	Promise.all([logoAnimation.finished, overlayFinished]).then(() => finishSplashAnimation(elements));
}

/**
 * Hides an element if it exists.
 * @param {HTMLElement} element
 */
function hideElement(element) {
	if (!element) return;
	element.style.display = 'none';
}

/**
 * Sets header logo visibility.
 * @param {HTMLElement} headerLogo
 * @param {boolean} isVisible
 */
function setHeaderLogoVisibility(headerLogo, isVisible) {
	if (!headerLogo) return;
	headerLogo.style.opacity = isVisible ? '1' : '0';
}

/**
 * Enables password visibility toggles.
 */
function initPasswordToggles() {
	document.querySelectorAll('input[type="password"]').forEach(setupPasswordToggle);
}

/**
 * Wires a password input with toggle icons.
 * @param {HTMLInputElement} input
 */
function setupPasswordToggle(input) {
	const wrapper = input.closest('.input-field');
	const iconBox = wrapper ? wrapper.querySelector('.input-icon') : null;
	const icon = iconBox ? iconBox.querySelector('img') : null;
	if (!iconBox || !icon) return;

	iconBox.classList.add('password-toggle');
	const lockSrc = icon.getAttribute('src') || '';
	const offSrc = lockSrc.replace(/[^/]+$/, 'visibility_off.svg');
	const onSrc = lockSrc.replace(/[^/]+$/, 'visibility.svg');

	const updateIcon = () => {
		if (!input.value) {
			icon.src = lockSrc;
			return;
		}
		icon.src = input.type === 'password' ? offSrc : onSrc;
	};

	iconBox.addEventListener('click', () => {
		if (!input.value) return;
		input.type = input.type === 'password' ? 'text' : 'password';
		updateIcon();
	});

	input.addEventListener('input', updateIcon);
	updateIcon();
}

/**
 * Initializes Firebase login handling for the login form.
 */
function initLoginForm() {
	const form = document.querySelector('.login-form');
	if (!form) return;

	const fields = getLoginFields(form);
	if (!fields) return;

	bindLoginFieldEvents(fields);
	form.addEventListener('submit', (event) => handleLoginSubmit(event, fields));
}

/**
 * Collects login form fields.
 * @param {HTMLFormElement} form
 * @returns {{form: HTMLFormElement, emailInput: HTMLInputElement, passwordInput: HTMLInputElement, submitButton: HTMLButtonElement, message: HTMLElement} | null}
 */
function getLoginFields(form) {
	const emailInput = form.querySelector('input[name="email"]');
	const passwordInput = form.querySelector('input[name="password"]');
	const submitButton = form.querySelector('button[type="submit"]');
	if (!emailInput || !passwordInput || !submitButton) return null;

	return { form, emailInput, passwordInput, submitButton, message: ensureFormMessage(form) };
}

/**
 * Ensures the form has a message element for feedback.
 * @param {HTMLFormElement} form
 * @returns {HTMLElement}
 */
function ensureFormMessage(form) {
	let message = form.querySelector('.form-message');
	if (message) return message;

	message = document.createElement('p');
	message.className = 'form-message';
	message.setAttribute('role', 'alert');
	message.style.marginTop = '12px';
	message.style.fontSize = '14px';
	message.style.color = '#FF3D00';
	form.appendChild(message);
	return message;
}

/**
 * Binds events to update login form button state.
 * @param {Object} fields
 */
function bindLoginFieldEvents(fields) {
	const updateState = () => updateLoginButtonState(fields);
	fields.emailInput.addEventListener('input', updateState);
	fields.passwordInput.addEventListener('input', updateState);
	updateLoginButtonState(fields);
}

/**
 * Enables/disables the login button based on form validity.
 * @param {Object} fields
 */
function updateLoginButtonState(fields) {
	const isValid = isLoginInputValid(fields);
	const isLoading = fields.submitButton.dataset.loading === '1';
	fields.submitButton.disabled = isLoading || !isValid;
}

/**
 * Validates login inputs.
 * @param {Object} fields
 * @returns {boolean}
 */
function isLoginInputValid(fields) {
	return isEmailValid(fields.emailInput.value) &amp;&amp; fields.passwordInput.value.trim().length > 0;
}

/**
 * Validates email address format.
 * @param {string} value
 * @returns {boolean}
 */
function isEmailValid(value) {
	return /^\S+@\S+\.\S+$/.test(value.trim());
}

/**
 * Handles Firebase login submission.
 * @param {SubmitEvent} event
 * @param {Object} fields
 */
async function handleLoginSubmit(event, fields) {
	event.preventDefault();
	setFormMessage(fields.message, '');

	if (!isLoginInputValid(fields)) {
		setFormMessage(fields.message, 'Bitte g체ltige Zugangsdaten eingeben.');
		return;
	}

	setLoadingState(fields, true);
	try {
		const credential = await firebase.auth().signInWithEmailAndPassword(
			fields.emailInput.value.trim(),
			fields.passwordInput.value
		);
		sessionStorage.setItem('userId', credential.user.uid);
		sessionStorage.removeItem('guestLogin');
		sessionStorage.setItem('skipSplash', '1');
		window.location.href = './sites/summary.html';
	} catch (error) {
		setFormMessage(fields.message, getAuthErrorMessage(error));
		console.error('Firebase login error:', error);
	} finally {
		setLoadingState(fields, false);
	}
}

/**
 * Sets the loading state for the login form.
 * @param {Object} fields
 * @param {boolean} isLoading
 */
function setLoadingState(fields, isLoading) {
	fields.submitButton.dataset.loading = isLoading ? '1' : '0';
	updateLoginButtonState(fields);
}

/**
 * Updates the form message.
 * @param {HTMLElement} message
 * @param {string} text
 */
function setFormMessage(message, text) {
	message.textContent = text;
}

/**
 * Maps Firebase auth errors to readable messages.
 * @param {unknown} error
 * @returns {string}
 */
function getAuthErrorMessage(error) {
	const fallback = 'Login fehlgeschlagen. Bitte versuche es erneut.';
	if (!error || typeof error !== 'object' || !('code' in error)) return fallback;

	switch (error.code) {
		case 'auth/invalid-credential':
		case 'auth/invalid-login-credentials':
			return 'E-Mail oder Passwort ist falsch.';
		case 'auth/invalid-email':
			return 'Bitte eine g체ltige E-Mail-Adresse eingeben.';
		case 'auth/user-not-found':
		case 'auth/wrong-password':
			return 'E-Mail oder Passwort ist falsch.';
		case 'auth/user-disabled':
			return 'Dieser Nutzer ist deaktiviert.';
		case 'auth/too-many-requests':
			return 'Zu viele Versuche. Bitte sp채ter erneut versuchen.';
		default:
			return fallback;
	}
}

/**
 * Wires the guest login button to open the summary page.
 */
function initGuestLogin() {
	const guestButton = document.querySelector('.guest-login');
	if (!guestButton) return;

	guestButton.addEventListener('click', handleGuestLogin);
}

/**
 * Navigates to the summary page for guest access.
 */
function handleGuestLogin() {
	sessionStorage.setItem('guestLogin', '1');
	sessionStorage.removeItem('userId');
	window.location.href = './sites/summary.html';
}

document.addEventListener('DOMContentLoaded', () => {
	runSplashAnimation();
	initGuestLogin();
	initLoginForm();
	initPasswordToggles();
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#animateSplashLogo">animateSplashLogo</a></li><li><a href="global.html#bindLoginFieldEvents">bindLoginFieldEvents</a></li><li><a href="global.html#bindSignupFieldEvents">bindSignupFieldEvents</a></li><li><a href="global.html#clearFieldError">clearFieldError</a></li><li><a href="global.html#clearSkipSplash">clearSkipSplash</a></li><li><a href="global.html#ensureFieldMessage">ensureFieldMessage</a></li><li><a href="global.html#ensureFormMessage">ensureFormMessage</a></li><li><a href="global.html#fadeOutOverlay">fadeOutOverlay</a></li><li><a href="global.html#finishSplashAnimation">finishSplashAnimation</a></li><li><a href="global.html#getAuthErrorMessage">getAuthErrorMessage</a></li><li><a href="global.html#getCenterDelta">getCenterDelta</a></li><li><a href="global.html#getLoginFields">getLoginFields</a></li><li><a href="global.html#getSignupFields">getSignupFields</a></li><li><a href="global.html#getSplashElements">getSplashElements</a></li><li><a href="global.html#getSplashStartScale">getSplashStartScale</a></li><li><a href="global.html#getTasks">getTasks</a></li><li><a href="global.html#getUserName">getUserName</a></li><li><a href="global.html#handleGuestLogin">handleGuestLogin</a></li><li><a href="global.html#handleLoginSubmit">handleLoginSubmit</a></li><li><a href="global.html#handleSignupSubmit">handleSignupSubmit</a></li><li><a href="global.html#hideElement">hideElement</a></li><li><a href="global.html#initGuestLogin">initGuestLogin</a></li><li><a href="global.html#initLoginForm">initLoginForm</a></li><li><a href="global.html#initPasswordToggles">initPasswordToggles</a></li><li><a href="global.html#initSignupBackButton">initSignupBackButton</a></li><li><a href="global.html#initSignupForm">initSignupForm</a></li><li><a href="global.html#isEmailValid">isEmailValid</a></li><li><a href="global.html#isLoginInputValid">isLoginInputValid</a></li><li><a href="global.html#isSignupInputValid">isSignupInputValid</a></li><li><a href="global.html#loadSummary">loadSummary</a></li><li><a href="global.html#prepareSplashLogo">prepareSplashLogo</a></li><li><a href="global.html#renderSummary">renderSummary</a></li><li><a href="global.html#renderUserName">renderUserName</a></li><li><a href="global.html#resolveActiveUserId">resolveActiveUserId</a></li><li><a href="global.html#runSplashAnimation">runSplashAnimation</a></li><li><a href="global.html#setFieldError">setFieldError</a></li><li><a href="global.html#setFormMessage">setFormMessage</a></li><li><a href="global.html#setGreeting">setGreeting</a></li><li><a href="global.html#setHeaderLogoVisibility">setHeaderLogoVisibility</a></li><li><a href="global.html#setLoadingState">setLoadingState</a></li><li><a href="global.html#setupPasswordToggle">setupPasswordToggle</a></li><li><a href="global.html#shouldSkipSplash">shouldSkipSplash</a></li><li><a href="global.html#showFinalSplashState">showFinalSplashState</a></li><li><a href="global.html#syncAnimationEnd">syncAnimationEnd</a></li><li><a href="global.html#updateLoginButtonState">updateLoginButtonState</a></li><li><a href="global.html#updateSignupButtonState">updateSignupButtonState</a></li><li><a href="global.html#validateSignupFields">validateSignupFields</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Jan 27 2026 20:41:09 GMT+0100 (Mitteleurop채ische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
