<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: sign-up.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: sign-up.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Sets a flag to skip the splash animation when returning to the login page.
 */
function initSignupBackButton() {
	const backButton = document.querySelector('.signup-back');
	if (!backButton) return;

	backButton.addEventListener('click', () => {
		sessionStorage.setItem('skipSplash', '1');
	});
}

/**
 * Initializes Firebase registration handling for the sign-up form.
 */
function initSignupForm() {
	const form = document.querySelector('.login-form');
	if (!form) return;

	const fields = getSignupFields(form);
	if (!fields) return;

	bindSignupFieldEvents(fields);
	form.addEventListener('submit', (event) => handleSignupSubmit(event, fields));
}

/**
 * Enables password visibility toggles.
 */
function initPasswordToggles() {
	document.querySelectorAll('input[type="password"]').forEach(setupPasswordToggle);
}

/**
 * Wires a password input with toggle icons.
 * @param {HTMLInputElement} input
 */
function setupPasswordToggle(input) {
	const wrapper = input.closest('.input-field');
	const iconBox = wrapper ? wrapper.querySelector('.input-icon') : null;
	const icon = iconBox ? iconBox.querySelector('img') : null;
	if (!iconBox || !icon) return;

	iconBox.classList.add('password-toggle');
	const lockSrc = icon.getAttribute('src') || '';
	const offSrc = lockSrc.replace(/[^/]+$/, 'visibility_off.svg');
	const onSrc = lockSrc.replace(/[^/]+$/, 'visibility.svg');

	const updateIcon = () => {
		if (!input.value) {
			icon.src = lockSrc;
			return;
		}
		icon.src = input.type === 'password' ? offSrc : onSrc;
	};

	iconBox.addEventListener('click', () => {
		if (!input.value) return;
		input.type = input.type === 'password' ? 'text' : 'password';
		updateIcon();
	});

	input.addEventListener('input', updateIcon);
	updateIcon();
}

/**
 * Collects sign-up form fields.
 * @param {HTMLFormElement} form
 * @returns {{form: HTMLFormElement, nameInput: HTMLInputElement, emailInput: HTMLInputElement, passwordInput: HTMLInputElement, confirmInput: HTMLInputElement, privacyInput: HTMLInputElement, submitButton: HTMLButtonElement, message: HTMLElement} | null}
 */
function getSignupFields(form) {
	const nameInput = form.querySelector('input[name="name"]');
	const emailInput = form.querySelector('input[name="email"]');
	const passwordInput = form.querySelector('input[name="password"]');
	const confirmInput = form.querySelector('input[name="confirmPassword"]');
	const privacyInput = form.querySelector('input[name="privacy"]');
	const submitButton = form.querySelector('button[type="submit"]');
	if (!nameInput || !emailInput || !passwordInput || !confirmInput || !privacyInput || !submitButton) return null;

	return {
		form,
		nameInput,
		emailInput,
		passwordInput,
		confirmInput,
		privacyInput,
		submitButton,
		nameMessage: ensureFieldMessage(nameInput),
		emailMessage: ensureFieldMessage(emailInput),
		passwordMessage: ensureFieldMessage(passwordInput),
		confirmMessage: ensureFieldMessage(confirmInput),
		privacyMessage: ensurePrivacyMessage(form),
	};
}

/**
 * Ensures an input has a field message element.
 * @param {HTMLInputElement} input
 * @returns {HTMLElement}
 */
function ensureFieldMessage(input) {
	const wrapper = input.closest('.input-field');
	if (!wrapper) return document.createElement('p');

	let message = wrapper.querySelector('.field-message');
	if (message) {
		message.style.display = 'block';
		message.style.visibility = 'hidden';
		return message;
	}

	message = document.createElement('p');
	message.className = 'field-message';
	message.setAttribute('role', 'alert');
	message.style.display = 'block';
	message.style.visibility = 'hidden';
	wrapper.appendChild(message);
	return message;
}

/**
 * Ensures the privacy checkbox has a message element.
 * @param {HTMLFormElement} form
 * @returns {HTMLElement}
 */
function ensurePrivacyMessage(form) {
	const row = form.querySelector('.checkbox-row');
	if (!row) return document.createElement('p');

	let message = form.querySelector('.privacy-message');
	if (message) {
		message.style.display = 'block';
		message.style.visibility = 'hidden';
		return message;
	}

	message = document.createElement('p');
	message.className = 'field-message privacy-message';
	message.setAttribute('role', 'alert');
	message.style.display = 'block';
	message.style.visibility = 'hidden';
	row.insertAdjacentElement('afterend', message);
	return message;
}

/**
 * Binds events to update sign-up form button state.
 * @param {Object} fields
 */
function bindSignupFieldEvents(fields) {
	const updateState = () => updateSignupButtonState(fields);
	fields.nameInput.addEventListener('input', () => {
		clearFieldError(fields.nameInput, fields.nameMessage);
		updateState();
	});
	fields.emailInput.addEventListener('input', () => {
		clearFieldError(fields.emailInput, fields.emailMessage);
		updateState();
	});
	fields.passwordInput.addEventListener('input', () => {
		clearFieldError(fields.passwordInput, fields.passwordMessage);
		updateState();
	});
	fields.confirmInput.addEventListener('input', () => {
		clearFieldError(fields.confirmInput, fields.confirmMessage);
		updateState();
	});
	fields.nameInput.addEventListener('blur', () => {
		if (fields.nameInput.value.trim().length > 0) {
			validateNameField(fields);
		}
	});
	fields.emailInput.addEventListener('blur', () => {
		if (fields.emailInput.value.trim().length > 0) {
			validateEmailField(fields);
		}
	});
	fields.passwordInput.addEventListener('blur', () => {
		if (fields.passwordInput.value.trim().length > 0) {
			validatePasswordField(fields);
		}
	});
	fields.confirmInput.addEventListener('blur', () => {
		if (fields.confirmInput.value.trim().length > 0) {
			validateConfirmField(fields);
		}
	});
	fields.privacyInput.addEventListener('change', () => {
		if (fields.privacyInput.checked) {
			clearFieldError(fields.privacyInput, fields.privacyMessage);
		}
		updateState();
	});
	updateSignupButtonState(fields);
}

/**
 * Enables/disables the sign-up button based on form validity.
 * @param {Object} fields
 */
function updateSignupButtonState(fields) {
	const isValid = isSignupInputReady(fields);
	const isLoading = fields.submitButton.dataset.loading === '1';
	fields.submitButton.disabled = isLoading || !isValid;
}

/**
 * Checks if required inputs (except privacy) are filled and valid.
 * @param {Object} fields
 * @returns {boolean}
 */
function isSignupInputReady(fields) {
	return (
		fields.nameInput.value.trim().length > 0 &amp;&amp;
		isEmailValid(fields.emailInput.value) &amp;&amp;
		fields.passwordInput.value.trim().length >= 6 &amp;&amp;
		fields.passwordInput.value === fields.confirmInput.value
	);
}

/**
 * Validates email address format.
 * @param {string} value
 * @returns {boolean}
 */
function isEmailValid(value) {
	return /^\S+@\S+\.\S+$/.test(value.trim());
}

/**
 * Handles Firebase sign-up submission.
 * @param {SubmitEvent} event
 * @param {Object} fields
 */
async function handleSignupSubmit(event, fields) {
	event.preventDefault();
	clearFieldError(fields.nameInput, fields.nameMessage);
	clearFieldError(fields.emailInput, fields.emailMessage);
	clearFieldError(fields.passwordInput, fields.passwordMessage);
	clearFieldError(fields.confirmInput, fields.confirmMessage);
	clearFieldError(fields.privacyInput, fields.privacyMessage);
	if (!validateSignupFields(fields)) return;

	setLoadingState(fields, true);
	try {
		const credential = await firebase.auth().createUserWithEmailAndPassword(
			fields.emailInput.value.trim(),
			fields.passwordInput.value
		);
		sessionStorage.setItem('userId', credential.user.uid);
		await credential.user.updateProfile({ displayName: fields.nameInput.value.trim() });
		await firebase.database().ref(`users/${credential.user.uid}`).set({
			name: fields.nameInput.value.trim(),
			email: fields.emailInput.value.trim(),
			createdAt: Date.now(),
		});
		sessionStorage.removeItem('guestLogin');
		sessionStorage.setItem('skipSplash', '1');
		window.location.href = './summary.html';
	} catch (error) {
		setFieldError(fields.emailInput, fields.emailMessage, getAuthErrorMessage(error));
	} finally {
		setLoadingState(fields, false);
	}
}

/**
 * Sets the loading state for the sign-up form.
 * @param {Object} fields
 * @param {boolean} isLoading
 */
function setLoadingState(fields, isLoading) {
	fields.submitButton.dataset.loading = isLoading ? '1' : '0';
	updateSignupButtonState(fields);
}

/**
 * Maps Firebase auth errors to readable messages.
 * @param {unknown} error
 * @returns {string}
 */
function getAuthErrorMessage(error) {
	const fallback = 'Registration failed. Please try again.';
	if (!error || typeof error !== 'object' || !('code' in error)) return fallback;

	switch (error.code) {
		case 'auth/operation-not-allowed':
			return 'Email/password sign-in is not enabled in Firebase yet.';
		case 'auth/network-request-failed':
			return 'Network error. Please check your connection.';
		case 'auth/email-already-in-use':
			return 'This email address is already registered.';
		case 'auth/invalid-email':
			return 'Please enter a valid email address.';
		case 'auth/weak-password':
			return 'Password is too weak. Please use at least 6 characters.';
		default:
			return fallback;
	}
}

/**
 * Validates sign-up inputs and shows inline errors.
 * @param {Object} fields
 * @returns {boolean}
 */
function validateSignupFields(fields) {
	let isValid = true;
	if (!validateNameField(fields)) isValid = false;
	if (!validateEmailField(fields)) isValid = false;
	if (!validatePasswordField(fields)) isValid = false;
	if (!validateConfirmField(fields)) isValid = false;
	if (!validatePrivacyField(fields)) isValid = false;
	return isValid;
}

/**
 * Validates the name field.
 * @param {Object} fields
 * @returns {boolean}
 */
function validateNameField(fields) {
	if (!fields.nameInput.value.trim()) {
		setFieldError(fields.nameInput, fields.nameMessage, 'Please enter a name.');
		return false;
	}
	return true;
}

/**
 * Validates the email field.
 * @param {Object} fields
 * @returns {boolean}
 */
function validateEmailField(fields) {
	if (!isEmailValid(fields.emailInput.value)) {
		setFieldError(fields.emailInput, fields.emailMessage, 'Please enter a valid email address.');
		return false;
	}
	return true;
}

/**
 * Validates the password field.
 * @param {Object} fields
 * @returns {boolean}
 */
function validatePasswordField(fields) {
	if (fields.passwordInput.value.trim().length &lt; 6) {
		setFieldError(fields.passwordInput, fields.passwordMessage, 'Password must be at least 6 characters long.');
		return false;
	}
	return true;
}

/**
 * Validates the confirm password field.
 * @param {Object} fields
 * @returns {boolean}
 */
function validateConfirmField(fields) {
	if (fields.passwordInput.value !== fields.confirmInput.value) {
		setFieldError(fields.confirmInput, fields.confirmMessage, 'Passwords do not match.');
		return false;
	}
	return true;
}

/**
 * Validates the privacy checkbox.
 * @param {Object} fields
 * @returns {boolean}
 */
function validatePrivacyField(fields) {
	if (!fields.privacyInput.checked) {
		setFieldError(fields.privacyInput, fields.privacyMessage, 'Please accept the privacy policy.');
		return false;
	}
	return true;
}

/**
 * Sets the error state for a field.
 * @param {HTMLInputElement} input
 * @param {HTMLElement} message
 * @param {string} text
 */
function setFieldError(input, message, text) {
	input.classList.add('input-error');
	message.textContent = text;
	message.style.visibility = 'visible';
}

/**
 * Clears the error state for a field.
 * @param {HTMLInputElement} input
 * @param {HTMLElement} message
 */
function clearFieldError(input, message) {
	input.classList.remove('input-error');
	message.textContent = '';
	message.style.visibility = 'hidden';
}

document.addEventListener('DOMContentLoaded', () => {
	initSignupBackButton();
	initSignupForm();
	initPasswordToggles();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#animateSplashLogo">animateSplashLogo</a></li><li><a href="global.html#bindLoginFieldEvents">bindLoginFieldEvents</a></li><li><a href="global.html#bindSignupFieldEvents">bindSignupFieldEvents</a></li><li><a href="global.html#clearFieldError">clearFieldError</a></li><li><a href="global.html#clearSkipSplash">clearSkipSplash</a></li><li><a href="global.html#closeTaskDetail">closeTaskDetail</a></li><li><a href="global.html#ensureFieldMessage">ensureFieldMessage</a></li><li><a href="global.html#ensureFormMessage">ensureFormMessage</a></li><li><a href="global.html#ensurePrivacyMessage">ensurePrivacyMessage</a></li><li><a href="global.html#fadeOutOverlay">fadeOutOverlay</a></li><li><a href="global.html#finishSplashAnimation">finishSplashAnimation</a></li><li><a href="global.html#getAuthErrorMessage">getAuthErrorMessage</a></li><li><a href="global.html#getCenterDelta">getCenterDelta</a></li><li><a href="global.html#getLoginFields">getLoginFields</a></li><li><a href="global.html#getSignupFields">getSignupFields</a></li><li><a href="global.html#getSplashElements">getSplashElements</a></li><li><a href="global.html#getSplashStartScale">getSplashStartScale</a></li><li><a href="global.html#getTasks">getTasks</a></li><li><a href="global.html#getUserName">getUserName</a></li><li><a href="global.html#handleGuestLogin">handleGuestLogin</a></li><li><a href="global.html#handleLoginSubmit">handleLoginSubmit</a></li><li><a href="global.html#handleOverlayClick">handleOverlayClick</a></li><li><a href="global.html#handleSignupSubmit">handleSignupSubmit</a></li><li><a href="global.html#hideElement">hideElement</a></li><li><a href="global.html#initGuestLogin">initGuestLogin</a></li><li><a href="global.html#initLoginForm">initLoginForm</a></li><li><a href="global.html#initPasswordToggles">initPasswordToggles</a></li><li><a href="global.html#initSignupBackButton">initSignupBackButton</a></li><li><a href="global.html#initSignupForm">initSignupForm</a></li><li><a href="global.html#isEmailValid">isEmailValid</a></li><li><a href="global.html#isLoginInputValid">isLoginInputValid</a></li><li><a href="global.html#isSignupInputReady">isSignupInputReady</a></li><li><a href="global.html#loadSummary">loadSummary</a></li><li><a href="global.html#onDrop">onDrop</a></li><li><a href="global.html#openTaskDetail">openTaskDetail</a></li><li><a href="global.html#prepareSplashLogo">prepareSplashLogo</a></li><li><a href="global.html#renderBoard">renderBoard</a></li><li><a href="global.html#renderSummary">renderSummary</a></li><li><a href="global.html#renderUserName">renderUserName</a></li><li><a href="global.html#resolveActiveUserId">resolveActiveUserId</a></li><li><a href="global.html#runSplashAnimation">runSplashAnimation</a></li><li><a href="global.html#setFieldError">setFieldError</a></li><li><a href="global.html#setFormMessage">setFormMessage</a></li><li><a href="global.html#setGreeting">setGreeting</a></li><li><a href="global.html#setHeaderLogoVisibility">setHeaderLogoVisibility</a></li><li><a href="global.html#setLoadingState">setLoadingState</a></li><li><a href="global.html#setLoginFieldErrorState">setLoginFieldErrorState</a></li><li><a href="global.html#setupPasswordToggle">setupPasswordToggle</a></li><li><a href="global.html#shouldSkipSplash">shouldSkipSplash</a></li><li><a href="global.html#showFinalSplashState">showFinalSplashState</a></li><li><a href="global.html#syncAnimationEnd">syncAnimationEnd</a></li><li><a href="global.html#updateLoginButtonState">updateLoginButtonState</a></li><li><a href="global.html#updateSignupButtonState">updateSignupButtonState</a></li><li><a href="global.html#validateConfirmField">validateConfirmField</a></li><li><a href="global.html#validateEmailField">validateEmailField</a></li><li><a href="global.html#validateNameField">validateNameField</a></li><li><a href="global.html#validatePasswordField">validatePasswordField</a></li><li><a href="global.html#validatePrivacyField">validatePrivacyField</a></li><li><a href="global.html#validateSignupFields">validateSignupFields</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Jan 28 2026 12:03:47 GMT+0100 (Mitteleurop√§ische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
